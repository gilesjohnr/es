<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="es">
<title>Calculating hydrological variables • es</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculating hydrological variables">
<meta property="og:description" content="es">
<meta property="og:image" content="https://gilesjohnr.github.io/es/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-HQPXKPQH2C"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HQPXKPQH2C');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">es</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/template_es_data.html">1. Data templates</a>
    <a class="dropdown-item" href="../articles/metadata_functions.html">2. Metadata</a>
    <a class="dropdown-item" href="../articles/derivative_quantities.html">3. qPCR absolute quantification</a>
    <a class="dropdown-item" href="../articles/derivative_quantities.html">4. qPCR relative quantification</a>
    <a class="dropdown-item" href="../articles/amplification_efficiency.html">5. qPCR amplification efficiency</a>
    <a class="dropdown-item" href="../articles/get_climate_data.html">6. Climate data</a>
    <a class="dropdown-item" href="../articles/calc_hydro_variables.html">7. Hydrological variables</a>
    <a class="dropdown-item" href="../articles/calc_local_population.html">8. Local population</a>
    <a class="dropdown-item" href="../articles/get_admin_data.html">9. Administrative boundaries</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gilesjohnr/es" aria-label="GitHub">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculating hydrological variables</h1>
            
      
      
      <div class="d-none name"><code>calc_hydro_variables.Rmd</code></div>
    </div>

    
    
<p>Environmental sampling for infectious diseases can take place in a
wide range of conditions. Although some studies are able to sample waste
water from relatively controled environments such as water treatment
facilities in high-income settings, there are also studies that must
collect samples from open sewers and streams in rural and/or low and
middile income settings. In the latter scenario, there are numerous
factors that affect waste water measurements and the question of how to
best sample these open environments and control for confounding factors
is an important topic of research. Therefore, we have included several
functions in the <code>es</code> package that assist in characterizing
local topography and hydrology which can help to evaluate differences
among sites and assess the potential effects of site location.</p>
<p>To characterize local topography and hydrology of sampling sites, we
have included the <code><a href="../reference/get_hydro_data.html">get_hydro_data()</a></code> function which takes a
Digital Elevation Model (DEM) and calculates the following spatial
variables for a given set of locations.</p>
<ul>
<li>Elevation (in meters)</li>
<li>Slope</li>
<li>Aspect</li>
<li>Topographical Wetness Index (TWI)</li>
<li>Flow accumulation</li>
<li>Total flow accumulation within 500m</li>
<li>Distance to the nearest stream</li>
</ul>
<p>See below for an example of how to use the <code>es</code> package to
calculate these hydrological variables for a set of sampling sites.</p>
<p><br></p>
<div class="section level3">
<h3 id="download-spatial-data">Download spatial data<a class="anchor" aria-label="anchor" href="#download-spatial-data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gilesjohnr.github.io/es/">es</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/" class="external-link">ggrepel</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Get data frame of simulated environmental sampling data</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> es<span class="sc">::</span>template_es_data</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">head</span>(df)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>date location_id  lat   lon target_name ct_value</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="dv">1</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span> <span class="fl">23.8</span> <span class="fl">90.37</span>    target_0       <span class="cn">NA</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="dv">2</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span> <span class="fl">23.8</span> <span class="fl">90.37</span>    target_0       <span class="cn">NA</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="dv">3</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span> <span class="fl">23.8</span> <span class="fl">90.37</span>    target_0       <span class="cn">NA</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="dv">4</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span> <span class="fl">23.8</span> <span class="fl">90.37</span>    target_0 <span class="fl">29.95670</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="dv">5</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span> <span class="fl">23.8</span> <span class="fl">90.37</span>    target_1 <span class="fl">31.60111</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="dv">6</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span> <span class="fl">23.8</span> <span class="fl">90.37</span>    target_1 <span class="fl">32.20208</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co"># Create a directory to download spatial data and save intermediate output</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="fu">getwd</span>(), <span class="st">'tmp'</span>))</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co"># Download a DEM for the area surrounding sampling sites</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="fu">download_elevation_data</span>(<span class="at">lon =</span> df<span class="sc">$</span>lon,</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>                        <span class="at">lat =</span> df<span class="sc">$</span>lat,</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>                        <span class="at">path_output =</span> <span class="fu">file.path</span>(<span class="fu">getwd</span>(), <span class="st">'tmp'</span>))</span></code></pre></div>
<p>The Digital Elevation Model (DEM) is downloaded to the ‘tmp’
directory.</p>
<p><img src="../reference/figures/dir_download_dem.png" style="width:70.0%"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="calculate-hydrological-variables">Calculate hydrological variables<a class="anchor" aria-label="anchor" href="#calculate-hydrological-variables"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Calculate topographical and hydrological variables for each sampling site</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>hydro <span class="ot">&lt;-</span> es<span class="sc">::</span><span class="fu">get_hydro_data</span>(</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>     <span class="at">lon =</span> template_es_data<span class="sc">$</span>lon,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>     <span class="at">lat =</span> template_es_data<span class="sc">$</span>lat,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>     <span class="at">path_dem_raster =</span> <span class="fu">file.path</span>(<span class="fu">getwd</span>(), <span class="st">'tmp/dem.tif'</span>),</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>     <span class="at">path_output =</span> <span class="fu">file.path</span>(<span class="fu">getwd</span>(), <span class="st">'tmp'</span>)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>hydro</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>lon   lat elevation slope aspect  twi flow_acc flow_acc_500m km_to_nearest_stream</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="dv">1</span> <span class="fl">90.37</span> <span class="fl">23.80</span>        <span class="dv">12</span>  <span class="fl">0.97</span>  <span class="fl">90.00</span> <span class="fl">4.77</span>     <span class="fl">2.00</span>       <span class="fl">5014.22</span>                 <span class="fl">2.19</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="dv">2</span> <span class="fl">90.38</span> <span class="fl">23.80</span>        <span class="dv">11</span>  <span class="fl">0.98</span> <span class="fl">262.55</span> <span class="fl">7.45</span>    <span class="fl">29.59</span>       <span class="fl">2706.60</span>                 <span class="fl">1.25</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="dv">3</span> <span class="fl">90.37</span> <span class="fl">23.81</span>        <span class="dv">20</span>  <span class="fl">1.79</span> <span class="fl">157.20</span> <span class="fl">3.46</span>     <span class="fl">1.00</span>       <span class="fl">2684.25</span>                 <span class="fl">1.92</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co"># Merge with environmental sampling data</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">merge</span>(df, hydro, <span class="at">by=</span><span class="fu">c</span>(<span class="st">'lon'</span>, <span class="st">'lat'</span>), <span class="at">all.x=</span>T)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="fu">head</span>(result)</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>lon  lat       date location_id target_name ct_value elevation slope aspect  twi flow_acc flow_acc_500m km_to_nearest_stream</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="dv">1</span> <span class="fl">90.37</span> <span class="fl">23.8</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span>    target_0       <span class="cn">NA</span>        <span class="dv">12</span>  <span class="fl">0.97</span>     <span class="dv">90</span> <span class="fl">4.77</span>        <span class="dv">2</span>       <span class="fl">5014.22</span>                 <span class="fl">2.19</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="dv">2</span> <span class="fl">90.37</span> <span class="fl">23.8</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span>    target_0       <span class="cn">NA</span>        <span class="dv">12</span>  <span class="fl">0.97</span>     <span class="dv">90</span> <span class="fl">4.77</span>        <span class="dv">2</span>       <span class="fl">5014.22</span>                 <span class="fl">2.19</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="dv">3</span> <span class="fl">90.37</span> <span class="fl">23.8</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span>    target_0       <span class="cn">NA</span>        <span class="dv">12</span>  <span class="fl">0.97</span>     <span class="dv">90</span> <span class="fl">4.77</span>        <span class="dv">2</span>       <span class="fl">5014.22</span>                 <span class="fl">2.19</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="dv">4</span> <span class="fl">90.37</span> <span class="fl">23.8</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span>    target_0 <span class="fl">29.95670</span>        <span class="dv">12</span>  <span class="fl">0.97</span>     <span class="dv">90</span> <span class="fl">4.77</span>        <span class="dv">2</span>       <span class="fl">5014.22</span>                 <span class="fl">2.19</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="dv">5</span> <span class="fl">90.37</span> <span class="fl">23.8</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span>    target_1 <span class="fl">31.60111</span>        <span class="dv">12</span>  <span class="fl">0.97</span>     <span class="dv">90</span> <span class="fl">4.77</span>        <span class="dv">2</span>       <span class="fl">5014.22</span>                 <span class="fl">2.19</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="dv">6</span> <span class="fl">90.37</span> <span class="fl">23.8</span> <span class="dv">2020-03-07</span>           <span class="dv">1</span>    target_1 <span class="fl">32.20208</span>        <span class="dv">12</span>  <span class="fl">0.97</span>     <span class="dv">90</span> <span class="fl">4.77</span>        <span class="dv">2</span>       <span class="fl">5014.22</span>                 <span class="fl">2.19</span></span></code></pre></div>
<p>The intermediate spatial data produced in the calculation of
topographical and hydrological variables are also saved to the ‘tmp’
output directory.</p>
<p><img src="../reference/figures/dir_output_hydro.png" style="width:70.0%"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="plot-results">Plot results<a class="anchor" aria-label="anchor" href="#plot-results"></a>
</h3>
<p>These output data can be used for further analysis and visualization.
Below is an example plot of the local population calculations shown
above.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'tmp'</span><span class="op">)</span></span>
<span><span class="va">rast_dem</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_path</span>, <span class="st">'dem.tif'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rast_slp</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_path</span>, <span class="st">'slope.tif'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rast_asp</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_path</span>, <span class="st">'aspect.tif'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rast_twi</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_path</span>, <span class="st">'twi.tif'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rast_acc</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_path</span>, <span class="st">'flow_acc.tif'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rast_hill</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_path</span>, <span class="st">'hillshade.tif'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">shp_streams</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">out_path</span>, <span class="st">'streams.shp'</span><span class="op">)</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://edzer.github.io/sp/reference/SpatialPoints.html" class="external-link">SpatialPoints</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">hydro</span><span class="op">$</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">hydro</span><span class="op">$</span><span class="va">lat</span><span class="op">)</span>, proj4string<span class="op">=</span><span class="fu"><a href="https://edzer.github.io/sp/reference/CRS-class.html" class="external-link">CRS</a></span><span class="op">(</span><span class="st">"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pts_buff_500</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/buffer.html" class="external-link">buffer</a></span><span class="op">(</span><span class="va">pts</span>, <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">plot_base</span> <span class="op">&lt;-</span></span>
<span>     <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span>box.padding   <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                               point.padding <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                               segment.color <span class="op">=</span> <span class="st">'black'</span>,</span>
<span>                               segment.size <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>na.value<span class="op">=</span><span class="st">'white'</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>           legend.position<span class="op">=</span><span class="st">'right'</span>,</span>
<span>           legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>           legend.key.height<span class="op">=</span><span class="fu">unit</span><span class="op">(</span><span class="fl">40</span>,<span class="st">'pt'</span><span class="op">)</span>,</span>
<span>           legend.key.width<span class="op">=</span><span class="fu">unit</span><span class="op">(</span><span class="fl">5</span>,<span class="st">'pt'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">rast_dem</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'DEM'</span></span>
<span></span>
<span><span class="va">plot_dem</span> <span class="op">&lt;-</span></span>
<span>     <span class="va">plot_base</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data<span class="op">=</span><span class="va">tmp</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, fill<span class="op">=</span><span class="va">DEM</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">hydro</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span>data<span class="op">=</span><span class="va">hydro</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span>, label<span class="op">=</span><span class="va">elevation</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggtitle</span><span class="op">(</span><span class="st">'DEM'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">rast_slp</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'slope'</span></span>
<span></span>
<span><span class="va">plot_slope</span> <span class="op">&lt;-</span></span>
<span>     <span class="va">plot_base</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data<span class="op">=</span><span class="va">tmp</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, fill<span class="op">=</span><span class="va">slope</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">hydro</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span>data<span class="op">=</span><span class="va">hydro</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span>, label<span class="op">=</span><span class="va">slope</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggtitle</span><span class="op">(</span><span class="st">'Slope'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">rast_asp</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'aspect'</span></span>
<span></span>
<span><span class="va">plot_aspect</span> <span class="op">&lt;-</span></span>
<span>     <span class="va">plot_base</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data<span class="op">=</span><span class="va">tmp</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, fill<span class="op">=</span><span class="va">aspect</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">hydro</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span>data<span class="op">=</span><span class="va">hydro</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span>, label<span class="op">=</span><span class="va">aspect</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggtitle</span><span class="op">(</span><span class="st">'Aspect'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">rast_twi</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'twi'</span></span>
<span></span>
<span><span class="va">plot_twi</span> <span class="op">&lt;-</span></span>
<span>     <span class="va">plot_base</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data<span class="op">=</span><span class="va">tmp</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, fill<span class="op">=</span><span class="va">twi</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">hydro</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span>data<span class="op">=</span><span class="va">hydro</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span>, label<span class="op">=</span><span class="va">twi</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggtitle</span><span class="op">(</span><span class="st">'Topographic\n Wetness Index (TWI)'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">rast_acc</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'flow_acc_100m'</span></span>
<span></span>
<span><span class="va">plot_acc_500m</span> <span class="op">&lt;-</span></span>
<span>     <span class="va">plot_base</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data<span class="op">=</span><span class="va">tmp</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, fill<span class="op">=</span><span class="va">flow_acc_100m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">hydro</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">pts_buff_500</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"red"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span>data<span class="op">=</span><span class="va">hydro</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span>, label<span class="op">=</span><span class="va">flow_acc_500m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggtitle</span><span class="op">(</span><span class="st">'Total flow accumulation\n (within 500m)'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">rast_hill</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'hillshade'</span></span>
<span></span>
<span><span class="va">plot_streams</span> <span class="op">&lt;-</span></span>
<span>     <span class="va">plot_base</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data<span class="op">=</span><span class="va">tmp</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, fill<span class="op">=</span><span class="va">hillshade</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradient2</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"black"</span>, high <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">shp_streams</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"blue"</span>, fill <span class="op">=</span> <span class="st">'blue'</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">hydro</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span>data<span class="op">=</span><span class="va">hydro</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">lon</span>, y<span class="op">=</span><span class="va">lat</span>, label<span class="op">=</span><span class="va">km_to_nearest_stream</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggtitle</span><span class="op">(</span><span class="st">'Distance to nearest\n stream (km)'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu">grid.arrange</span><span class="op">(</span><span class="va">plot_dem</span>, <span class="va">plot_slope</span>, <span class="va">plot_aspect</span>,</span>
<span>                        <span class="va">plot_twi</span>, <span class="va">plot_acc_500m</span>, <span class="va">plot_streams</span>,</span>
<span>                        ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/map_output_hydro.png" style="width:160.0%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by John R Giles.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
